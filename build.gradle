plugins {
    id 'java'
    id 'org.springframework.boot' version '3.3.4'
    id 'io.spring.dependency-management' version '1.1.7'
}

group = 'com.example'
version = '1.0.0'
description = 'Quora Application Backend'

java {
    sourceCompatibility = JavaVersion.VERSION_17
    targetCompatibility = JavaVersion.VERSION_17
}

configurations {
    compileOnly {
        extendsFrom annotationProcessor
    }
}

repositories {
    mavenCentral()
}

dependencies {
    // ============================================================================
    // Spring Boot Web & Core
    // ============================================================================
    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'org.springframework.boot:spring-boot-starter-webflux'

    // ============================================================================
    // Spring Boot Data & Persistence
    // ============================================================================
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'

    // ============================================================================
    // Redis Cache Configuration
    // ============================================================================
    implementation 'org.springframework.boot:spring-boot-starter-data-redis'
    implementation 'redis.clients:jedis:5.0.1'

    // ============================================================================
    // Security & Authentication
    // ============================================================================
    implementation 'org.springframework.boot:spring-boot-starter-security'

    // ============================================================================
    // JWT (JJWT) - ALL THREE REQUIRED
    // ============================================================================
    implementation 'io.jsonwebtoken:jjwt-api:0.12.3'
    runtimeOnly 'io.jsonwebtoken:jjwt-impl:0.12.3'
    runtimeOnly 'io.jsonwebtoken:jjwt-jackson:0.12.3'

    // ============================================================================
    // Kafka Event Streaming
    // ============================================================================
    implementation 'org.springframework.kafka:spring-kafka'
    implementation 'org.apache.kafka:kafka-clients:3.6.0'

    // ============================================================================
    // Database
    // ============================================================================
    runtimeOnly 'com.mysql:mysql-connector-j'
    runtimeOnly 'com.h2database:h2'

    // ============================================================================
    // JSON Processing
    // ============================================================================
    implementation 'com.fasterxml.jackson.core:jackson-databind'
    implementation 'com.fasterxml.jackson.datatype:jackson-datatype-jsr310'

    // ============================================================================
    // Validation
    // ============================================================================
    implementation 'org.springframework.boot:spring-boot-starter-validation'

    // ============================================================================
    // Monitoring & Observability
    // ============================================================================
    implementation 'org.springframework.boot:spring-boot-starter-actuator'
    implementation 'io.micrometer:micrometer-registry-prometheus'

    // ============================================================================
    // Logging
    // ============================================================================
    implementation 'org.springframework.boot:spring-boot-starter-logging'

    // ============================================================================
    // Utilities & Helpers
    // ============================================================================
    implementation 'org.apache.commons:commons-lang3:3.12.0'
    implementation 'commons-io:commons-io:2.11.0'

    // ============================================================================
    // Lombok (Code Generation)
    // ============================================================================
    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'

    // ============================================================================
    // API Documentation (Swagger/OpenAPI)
    // ============================================================================
    implementation 'org.springdoc:springdoc-openapi-starter-webmvc-ui:2.0.2'

    // ============================================================================
    // Development Tools
    // ============================================================================
    developmentOnly 'org.springframework.boot:spring-boot-devtools'

    // ============================================================================
    // Testing
    // ============================================================================
    testImplementation 'org.springframework.boot:spring-boot-starter-test'
    testImplementation 'org.springframework.security:spring-security-test'
    testImplementation 'org.springframework.kafka:spring-kafka-test'
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'
}

tasks.named('test') {
    useJUnitPlatform()
}

// ============================================================================
// Build Configuration
// ============================================================================

bootRun {
    args = ['--spring.profiles.active=dev']
}

jar {
    enabled = false
}

bootJar {
    archiveBaseName = 'quora-app'
    archiveVersion = '1.0.0'
}

tasks.register('printDependencies') {
    doLast {
        println '''
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘        âœ… Quora Application - Production Ready Config          â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        ğŸ“¦ Framework & Core:
           âœ… Spring Boot 3.3.4 - Latest LTS
           âœ… Java 17+ - Modern Java
           
        ğŸ” Security & Authentication:
           âœ… Spring Security 6.x - Enterprise Security
           âœ… JWT (JJWT 0.12.3) - Secure Token Auth
           
        ğŸ’¾ Data & Persistence:
           âœ… Spring Data JPA - ORM
           âœ… MySQL 8.0 - Database
           âœ… H2 - Testing Database
           
        ğŸš€ Caching & Performance:
           âœ… Redis 7.2 - In-Memory Cache
           âœ… Jedis 5.0.1 - Redis Client
           âœ… Spring Cache Abstraction
           
        ğŸ“¨ Event Streaming:
           âœ… Apache Kafka 3.6.0 - Message Broker
           âœ… Spring Kafka - Integration
           âœ… Auto-Topic Creation
           
        ğŸ“Š Monitoring & Observability:
           âœ… Prometheus - Metrics Collection
           âœ… Spring Actuator - Health Checks
           âœ… Micrometer - Metrics Library
           
        ğŸ“ JSON & Serialization:
           âœ… Jackson - JSON Processing
           âœ… Jackson JSR310 - Date/Time Support
           
        ğŸ“š API Documentation:
           âœ… SpringDoc OpenAPI 2.0.2 - Swagger UI
           âœ… Interactive API Documentation
           
        ğŸ› ï¸ Development Tools:
           âœ… Lombok - Less Boilerplate Code
           âœ… Spring DevTools - Hot Reload
           
        ğŸ§ª Testing:
           âœ… JUnit 5 - Testing Framework
           âœ… Spring Test - Integration Testing
           âœ… Security Test - Auth Testing
           âœ… Kafka Test - Message Testing
           
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘                   All components configured! âœ…                â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        '''
    }
}

tasks.register('showVersion') {
    doLast {
        println """
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘                    Project Information                         â•‘
        â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
        â•‘ Project: ${rootProject.name}
        â•‘ Version: ${version}
        â•‘ Description: ${project.description}
        â•‘ Spring Boot: 3.3.4
        â•‘ Java Version: 17+
        â•‘ Status: âœ… Production Ready
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        """
    }
}